Option Compare Database

' ***************************************** SQL создания полей
Function CreateFieldStatement(td, fld) As String
    result = "  `" & fld.name & "`"

    Select Case fld.Type
        Case dbDate, dbTime, dbTimeStamp
            result = result & " DATETIME"
        Case dbMemo    'Memo/Long Text, Hyperlinks
            result = result & " LONGTEXT"
        Case dbByte
            result = result & " TINYINT(3) UNSIGNED"
        Case dbInteger
            result = result & " INTEGER"
        Case dbLong
            result = result & " INTEGER"
        Case dbNumeric, dbDecimal
            result = result & " DECIMAL(" & ADOXCol.Precision & ", " & ADOXCol.NumericScale & ")"
        Case dbSingle, dbFloat
            result = result & " FLOAT"
        Case dbDouble
            result = result & " DOUBLE"
        Case dbGUID
            result = result & " GUID"
        Case dbBoolean
            result = result & " TINYINT"
        Case dbCurrency
            result = result & " DECIMAL(19,4)"
        Case dbText
            result = result & " VARCHAR(" & fld.Size & ")"
        Case Else
            result = result & " ????"
            Stop
    End Select

    If fld.DefaultValue <> "" Then
        If fld.Type = dbBoolean Then
            result = result & " DEFAULT " & IIf(fld.DefaultValue = "NO", 0, 1)
        Else
            result = result & " DEFAULT " & fld.DefaultValue
        End If
    End If

    If (fld.Attributes And dbAutoIncrField) Then
        result = result & " AUTO_INCREMENT"
    End If

    If fld.Required Then result = result & " NOT NULL"
    CreateFieldStatement = result & "," & vbCrLf
End Function

' ***************************************** SQL создания таблицы
Function CreateTableStatement(ByRef td)
    result = result & "CREATE TABLE `" & td.name & "`(" & vbCrLf
    For Each fld In td.Fields
        result = result & CreateFieldStatement(td, fld)
    Next fld
    result = result & GenPKStatement(td) ' GET PK Field to define the INDEX
    Do While Right(result, 1) = Chr(10) Or Right(result, 1) = Chr(13) Or Right(result, 1) = ","
        result = Mid(result, 1, Len(result) - 1)
    Loop
    CreateTableStatement = result & ")" & ";"
End Function

' *****************************************
Public Function GenPKStatement(tdf) As String
    Dim sPkFlds               As String
    Dim aPkFlds()             As String
    If tdf.Indexes.Count > 0 Then
        sPkFlds = Replace(tdf.Indexes("PrimaryKey").Fields, "+", "")
        aPkFlds = Split(sPkFlds, ";")
        If UBound(aPkFlds) = 0 Then
            GenPKStatement = "  PRIMARY KEY (`" & sPkFlds & "`)" & vbCrLf
        End If
    End If
End Function
